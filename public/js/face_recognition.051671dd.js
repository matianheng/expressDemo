(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["face_recognition"],{"634c":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"face tc phone-pad"},[a("div",{directives:[{name:"show",rawName:"v-show",value:1==t.isShow,expression:"isShow==1"}]},[t._m(0),t._m(1),t._m(2),a("div",{staticClass:"btn font-bold"},[a("div",{staticClass:"phone-pad"},[a("label",{staticClass:"mybtn"},[t._v("开始录制"),a("input",{ref:"VideoRef",attrs:{type:"file",capture:"user",id:"fileselect",accept:"video/*"},on:{change:t.takeVideo}})])])])]),t.noticeShow?a("div",{staticClass:"credentials-bg hiddenbg tc"},[a("div",{staticClass:"credentials-bg-main hiddenbg_div"},[a("div",{staticClass:"credentials-bg-top"},[0==t.noticeStatus||1==t.noticeStatus||4==t.noticeStatus||2==t.noticeStatus?a("div",{staticClass:"text1"},[t._v("识别失败")]):t._e(),0==t.noticeStatus?a("div",{staticClass:"text2 tl"},[t._v("\n          1. 确保本人面部出现在框内"),a("br"),t._v("\n          2. 确保面部与屏幕保持适当距离"),a("br"),t._v("\n          3. 保持光鲜充足和均匀"),a("br"),t._v("\n          4. 摘掉眼镜并露出耳朵\n        ")]):t._e(),1==t.noticeStatus||2==t.noticeStatus?a("div",{staticClass:"text2"},[t._v("请确保您的姓名、身份证号与人脸信息一致")]):t._e(),4==t.noticeStatus?a("div",{staticClass:"text2"},[t._v("如有疑问请联系客服")]):t._e(),4==t.noticeStatus?a("div",{staticClass:"text2 text4"},[a("a",{attrs:{href:"tel:400-2222-222"}},[t._v("400-2222-222")])]):t._e(),5==t.noticeStatus?a("div",{staticClass:"text2"},[t._v("视频时间只能为2~3秒，请重新拍摄")]):t._e()]),a("div",{staticClass:"flex font-bold toast-mybtn"},[1==t.noticeStatus?a("div",{staticClass:"munual-btn1",on:{click:function(e){return e.stopPropagation(),t.closeDialog.apply(null,arguments)}}},[t._v("再试一次")]):t._e(),1==t.noticeStatus?a("div",{staticClass:"line"}):t._e(),1==t.noticeStatus||2==t.noticeStatus?a("div",{staticClass:"munual-btn2",on:{click:function(e){return e.stopPropagation(),t.gotoRouter("writeMes")}}},[t._v("启用人工审核")]):t._e(),0==t.noticeStatus?a("div",{staticClass:"munual-btn2",on:{click:function(e){return e.stopPropagation(),t.closeDialog.apply(null,arguments)}}},[t._v("重新识别")]):t._e(),4==t.noticeStatus?a("div",{staticClass:"munual-btn2",on:{click:function(e){return e.stopPropagation(),t.closePage.apply(null,arguments)}}},[t._v("我知道了")]):t._e(),5==t.noticeStatus?a("div",{staticClass:"munual-btn2",on:{click:function(e){return e.stopPropagation(),t.openVideo.apply(null,arguments)}}},[t._v("我知道了")]):t._e()])])]):t._e(),a("video",{staticStyle:{"object-fit":"fill"},attrs:{muted:"",id:"recordVideo",playsinline:"true","webkit-playsinline":"true","x5-video-player-fullscreen":"true","x5-video-player-type":"h5","x5-video-orientation":"landscape",controls:"controls",preload:"auto","x-webkit-airplay":"allow"},domProps:{muted:!0}})])},o=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"title onlyFlex flex-wrap-wrap"},[a("div",[t._v("请录制一段2～3秒的多次眨眼小视频")]),a("div",[t._v("请确保脸部清晰完整、光线充足")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"img bgCss"},[a("div",{staticClass:"tag bgCss"},[a("div",[t._v("眨眨眼")])]),a("div",{staticClass:"text"},[t._v("视频录制规范")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"onlyFlex show box space_between"},[a("div",[a("div",{staticClass:"bgCss bg1 bg"}),a("div",{staticClass:"text"},[t._v("请保持脸部完整对准框内")])]),a("div",[a("div",{staticClass:"bgCss bg2 bg"}),a("div",{staticClass:"text"},[t._v("避免光线过亮")])]),a("div",[a("div",{staticClass:"bgCss bg2 bg"}),a("div",{staticClass:"text"},[t._v("避免光线过亮")])])])}],s=(a("4917"),a("7f7f"),a("34ef"),a("28a5"),a("4626")),n={name:"face_recognition",data:function(){return{isShow:1,noticeShow:!1,noticeStatus:-1,errorNum:0,videoRecordJson:{file:"",url:""}}},components:{},activated:function(){this.fromType=this.$route.query.fromType,this.errorNum=0},mounted:function(){},methods:{closePage:function(){"app"==this.$route.query.type?Object(s["a"])("finishPage"):(this.$router.go(-1),this.closeDialog())},closeDialog:function(){this.noticeShow=!1,this.noticeStatus=-1,sessionStorage.videoData=""},gotoRouter:function(t){this.$router.push({name:t,query:{typeName:encodeURIComponent("居民身份证"),type:this.$route.query.type}}),this.closeDialog()},gotoVd:function(){"app"==this.$route.query.type?Object(s["a"])("scanFace"):this.isShow=2},isError:function(){this.$LoadingHide(),this.noticeShow||(this.noticeShow=!0,3==this.fromType?this.errorNum<3?this.noticeStatus=0:this.noticeStatus=4:this.errorNum<3?this.noticeStatus=1:this.noticeStatus=2,this.errorNum++)},getVideo:function(t){console.log("获取到了录制的视频data=",{data:t,size:t.file.size});var e=t.file,a=(new FileReader,this);this.isShow=1,a.$LoadingShow("上传并验证中…");try{var i=new FormData;i.append("appkey","69b255a8f25e88d1d5404056611c29d3"),i.append("data",e,"file_"+Date.parse(new Date)+".mp4"),$.ajax({type:"post",url:"https://file.chinadatapay.com/img/upload",contentType:!1,processData:!1,data:i,dataType:"JSON",success:function(t){if(console.log(t),t&&t.data){var e=t.data;a.tradeUser(e)}else a.isError()},error:function(t,e,i,o){a.isError()}})}catch(o){console.log("errr===",o),a.isError()}},tradeUser:function(t){var e=new FormData;e.append("key","69b255a8f25e88d1d5404056611c29d3"),e.append("imageId",t);var a=this;$.ajax({type:"post",url:"https://api1.chinadatapay.com/trade/user/9204",contentType:!1,processData:!1,data:e,dataType:"JSON",success:function(t){if(console.log("请求成功==",t),t&&"10000"==t.code&&t.data&&t.data.return_image){var e=t.data.return_image;a.getImageId(e)}else a.isError()},error:function(t){a.isError(),console.log("请求失败==",t)}})},getImageId:function(t){console.log("获取请求的img",{img:t});var e=this.changeBlob(t,"image/jpeg");console.log("获取到的file=",{file:e});var a=new FormData;a.append("appkey","69b255a8f25e88d1d5404056611c29d3"),a.append("data",e,"file_"+Date.parse(new Date)+".jpeg");var i=this;$.ajax({type:"post",url:"https://file.chinadatapay.com/img/upload",contentType:!1,processData:!1,data:a,dataType:"JSON",success:function(t){if(console.log("获取到的imageId=",t),t&&"10000"==t.code&&t.data){var e=t.data;sessionStorage.videoData=e,i.$router.go(-1)}else i.isError(),sessionStorage.videoData="";i.$LoadingHide()},error:function(t,e,a,o){sessionStorage.videoData="",i.isError()}})},changeBlob:function(t,e){t="data:image/jpg;base64,"+t;for(var a=window.atob(t.split(",")[1]),i=new ArrayBuffer(a.length),o=new Uint8Array(i),s=0;s<a.length;s++)o[s]=a.charCodeAt(s);return new Blob([i],{type:e})},openVideo:function(){this.$refs.VideoRef.click(),this.noticeShow=!1,this.noticeStatus=-1},takeVideo:function(t){var e=this.$refs.VideoRef,a=e.files;console.log({e:t,fileJson:a}),console.log(a.files,a[0]);var i=a[0],o=window.URL?window.URL.createObjectURL(i):window.webkitURL.createObjectURL(i);console.log("视频的url=",o);var s=this;if(browser.versions.android){var n=function t(e){s.dealDuration(r.duration,i,e,o),r.removeEventListener("loadedmetadata",t)},r=document.getElementById("recordVideo");r.addEventListener("loadedmetadata",n),r.src=o}else{var c=function t(e){s.dealDuration(l.duration,i,e,o),l.removeEventListener("loadedmetadata",t)};console.log("是否能播放视频");var l=new Audio(o);l.muted=!0,l.addEventListener("loadedmetadata",c),l.play().then((function(){return l.pause()}))}},dealDuration:function(t,e,a,i){var o=this;if(t=Math.floor(t),t<=3&&t>=2){console.log("老的视频录制==",{video:e},e.name,e.size);var s=new FileReader;s.onload=function(t){var e=o.dataURLtoFile(t.target.result,"aa.mp4");console.log("转换为新的video==",e,e.size,e.name),o.videoRecordJson.file=e,o.videoRecordJson.url=i,o.saver()},s.readAsDataURL(e)}else console.log("视频时间只能为2~3秒，请重新拍摄"),this.noticeShow=!0,this.noticeStatus=5,this.resetVideoRecord()},dataURLtoFile:function(t,e){var a=t.split(","),i=(a[0].match(/:(.*?);/)[1],atob(a[1])),o=i.length,s=new Uint8Array(o);while(o--)s[o]=i.charCodeAt(o);return new File([s],e,{type:"video/mp4"})},saver:function(){var t=this.videoRecordJson.file;this.getVideo({file:t,url:this.videoRecordJson.url})},resetVideoRecord:function(){this.videoRecordJson.file=null,this.videoRecordJson.url=null}}},r=n,c=(a("7228"),a("2877")),l=Object(c["a"])(r,i,o,!1,null,"80cdcc42",null);e["default"]=l.exports},7228:function(t,e,a){"use strict";a("81f7")},"81f7":function(t,e,a){}}]);
//# sourceMappingURL=face_recognition.051671dd.js.map